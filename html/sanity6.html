<!-- https://jay23606.github.io/chat-gpt-voice/html/sanity6.html -->

<!DOCTYPE html>
<html>
  <body>
    <h1>Sanity.io Example</h1>
    
    <label for="keyInput">Enter Key:</label>
    <input type="text" id="keyInput" value="myKey">
    
    <button id="setData">Set Data</button>
    <button id="getData">Get Data</button>
    <button id="removeData">Remove Data</button>
    <button id="showKeys">Show Keys</button>
    
    <ul id="dataList">
    </ul>

    <ul id="keyList">
    </ul>
    
    <script src="https://unpkg.com/@sanity/client/umd/sanityClient.js"></script>
    <script>
const { createClient } = SanityClient;

const client = createClient({
  projectId: 'b3rj1ubh',
  dataset: 'production',
  token: 'skOzyD4VViJ88amMAqteATe2ebZRfoPsHN4U9u1bvC6a1swtKvSKqe25j2D96wKrB3TVnz7cLHR3Mkld5dyeDKw3HE9s0kcTDTcwsO1qKv6hMHUSoS9yOMkfevPS7vMxW1gqA2kXLzBAPoO4NiNqQ1OofngwJIVfkdN9UgE2TaYBltmLUVJw',
  useCdn: true,
  apiVersion: '2023-05-03',
});

const publicStorage = {
  async getItem(key) {
    const data = await client.fetch('*[_type == $type && key == $key]', {
      type: 'publicData',
      key,
    });
    return data[0]?.value;
  },

  async setItem(key, value) {
    const data = await client.fetch('*[_type == $type && key == $key]', {
      type: 'publicData',
      key,
    });
    const action = data[0]
      ? client.patch(data[0]._id).set({ _type: 'publicData', value })
      : client.create({ _type: 'publicData', key, value });

    await client.transaction().createIfNotExists({
      _id: `publicData.${key}`,
      _type: 'publicData', // Add _type field
    }).commit();

    await client.transaction().patch(`publicData.${key}`).createOrReplace(action).commit();

  //await client.transaction().patch(`publicData.${key}`).createOrReplace({
  //  ...action,
  //  _type: 'publicData', // Add _type field
  //}).commit();

  },

  async removeItem(key) {
    const data = await client.fetch('*[_type == $type && key == $key]', {
      type: 'publicData',
      key,
    });
    if (data[0]) {
      await client.transaction().delete(data[0]._id).commit();
    }
  },

  async getAllKeys() {
    const data = await client.fetch('*[_type == $type]', {
      type: 'publicData',
    });
    return data.map(item => item.key);
  }
};
    </script>
    <script>
      const setDataButton = document.getElementById('setData');
      const getDataButton = document.getElementById('getData');
      const removeDataButton = document.getElementById('removeData');
      const showKeysButton = document.getElementById('showKeys');
      const dataList = document.getElementById('dataList');
      const keyList = document.getElementById('keyList');
      const keyInput = document.getElementById('keyInput');

      setDataButton.addEventListener('click', async () => {
        const key = keyInput.value;
        const value = prompt('Enter a value to store:');
        if (value) {
          await publicStorage.setItem(key, value);
          alert('Value stored successfully!');
        }
      });

      getDataButton.addEventListener('click', async () => {
        const key = keyInput.value;
        const value = await publicStorage.getItem(key);
        if (value) {
          dataList.innerHTML = `<li>${value}</li>`;
        } else {
          dataList.innerHTML = `<li>No data found</li>`;
        }
      });

      removeDataButton.addEventListener('click', async () => {
        const key = keyInput.value;
        await publicStorage.removeItem(key);
        alert('Value removed successfully!');
      });

      showKeysButton.addEventListener('click', async () => {
        const keys = await publicStorage.getAllKeys();
        if (keys.length > 0) {
          keyList.innerHTML = keys.map(key => `<li>${key}</li>`).join('');
        } else {
          keyList.innerHTML = `<li>No keys found</li>`;
        }
      });
    </script>
  </body>
</html>
